<div class="form-container">
  <mat-card class="form-card">
    <mat-card-content>
      <form [formGroup]="personalInfoForm" (ngSubmit)="onSubmit(stepper)">
        <mat-stepper #stepper linear="true" class="form-stepper">
          <!-- Step 1: Personal Information -->
          <mat-step [stepControl]="personalInfoForm">
            <ng-template matStepLabel>Personal Information</ng-template>

            <div class="form-step-content">
              <h2 class="step-title">Tu informaci√≥n b√°sica (pero poderosa)</h2>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Nombre completo:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="fullName"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('fullName')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('fullName')" class="form-error">
                    {{ getErrorMessage("fullName") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Documento de identidad:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="identityDocument"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('identityDocument')"
                    />
                  </div>
                  <span
                    *ngIf="isFieldInvalid('identityDocument')"
                    class="form-error"
                  >
                    {{ getErrorMessage("identityDocument") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field half-width">
                  <label class="form-label">
                    Fecha de nacimiento:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      #birthDateInput
                      matInput
                      type="text"
                      formControlName="birthDate"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('birthDate')"
                      [matDatepicker]="birthDatePicker"
                      (focus)="birthDatePicker.open()"
                      readonly
                    />
                    <mat-datepicker
                      #birthDatePicker
                      (closed)="onDatepickerClosed(birthDateInput)"
                    ></mat-datepicker>
                  </div>
                  <span *ngIf="isFieldInvalid('birthDate')" class="form-error">
                    {{ getErrorMessage("birthDate") }}
                  </span>
                </div>

                <div class="form-field half-width">
                  <label class="form-label">
                    Lugar de nacimiento:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="birthPlace"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('birthPlace')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('birthPlace')" class="form-error">
                    {{ getErrorMessage("birthPlace") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Correo electr√≥nico:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="email"
                      formControlName="email"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('email')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('email')" class="form-error">
                    {{ getErrorMessage("email") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field half-width">
                  <label class="form-label">
                    Ciudad dondo vives:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="city"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('city')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('city')" class="form-error">
                    {{ getErrorMessage("city") }}
                  </span>
                </div>

                <div class="form-field half-width">
                  <label class="form-label">
                    Pa√≠s donde vives:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <select
                      formControlName="country"
                      class="form-select"
                      [class.invalid]="isFieldInvalid('country')"
                    >
                      <option value="" disabled></option>
                      <option
                        *ngFor="let country of countries"
                        [value]="country"
                      >
                        {{ country }}
                      </option>
                    </select>
                  </div>
                  <span *ngIf="isFieldInvalid('country')" class="form-error">
                    {{ getErrorMessage("country") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    N√∫mero de tel√©fono:
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="phone-input-wrapper">
                    <div class="phone-country-selector">
                      <button
                        type="button"
                        class="phone-country-button"
                        (click)="toggleCountryDropdown()"
                      >
                        <span class="phone-flag">{{
                          selectedPhoneCountry?.flag || "üè≥Ô∏è"
                        }}</span>
                        <span class="phone-code">{{
                          selectedPhoneCountry?.code || "+57"
                        }}</span>
                        <span class="phone-chevron">‚ñº</span>
                      </button>
                      <div
                        class="phone-country-dropdown"
                        [class.show]="showCountryDropdown"
                      >
                        <div
                          *ngFor="let country of phoneCountries"
                          class="phone-country-option"
                          (click)="selectPhoneCountry(country)"
                        >
                          <span class="phone-flag">{{ country.flag }}</span>
                          <span class="phone-code">{{ country.code }}</span>
                          <span class="phone-name">{{ country.name }}</span>
                        </div>
                      </div>
                    </div>
                    <input
                      type="tel"
                      formControlName="phoneNumber"
                      class="form-input phone-input"
                      [class.invalid]="isFieldInvalid('phoneNumber')"
                    />
                  </div>
                  <span
                    *ngIf="isFieldInvalid('phoneNumber')"
                    class="form-error"
                  >
                    {{ getErrorMessage("phoneNumber") }}
                  </span>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="isSubmitting || personalInfoForm.invalid"
                class="next-button"
              >
                <span *ngIf="!isSubmitting">Siguiente</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 2: Professional Information -->
          <mat-step [stepControl]="professionalInfoForm">
            <ng-template matStepLabel>Professional Information</ng-template>

            <div class="form-step-content" [formGroup]="professionalInfoForm">
              <h2 class="step-title">Tu historial profesional</h2>

              <!-- Professional History Section -->
              <div class="form-section">
                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Colegio:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="school"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('school', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('school', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("school", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Pregrado / Postgrado / Maestr√≠a:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="degree"
                        rows="3"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('degree', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="isFieldInvalid('degree', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("degree", professionalInfoForm) }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Work Experience Section -->
              <div class="form-section">
                <h3 class="section-title">Experiencia laboral</h3>

                <div class="form-row">
                  <div class="form-field half-width">
                    <label class="form-label">
                      Empresa:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="company"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('company', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('company', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("company", professionalInfoForm) }}
                    </span>
                  </div>

                  <div class="form-field half-width">
                    <label class="form-label">
                      Cargo:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="position"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('position', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('position', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("position", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field half-width">
                    <label class="form-label">
                      Fecha de inicio:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        #startDateInput
                        matInput
                        type="text"
                        formControlName="startDate"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('startDate', professionalInfoForm)
                        "
                        [matDatepicker]="startDatePicker"
                        (focus)="startDatePicker.open()"
                        readonly
                      />
                      <mat-datepicker
                        #startDatePicker
                        (closed)="onDatepickerClosed(startDateInput)"
                      ></mat-datepicker>
                    </div>
                    <span
                      *ngIf="isFieldInvalid('startDate', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("startDate", professionalInfoForm) }}
                    </span>
                  </div>

                  <div class="form-field half-width">
                    <label class="form-label">
                      Fecha de finalizaci√≥n:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="endDate"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('endDate', professionalInfoForm)
                        "
                      />
                    </div>
                    <span class="text-xs text-gray-500 mt-1 block">
                      Si actualmente est√°s en la empresa, agrega la fecha actual
                      y escribe "Actualmente" aqu√≠
                    </span>
                    <span
                      *ngIf="isFieldInvalid('endDate', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("endDate", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      L√≠der inmediato:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="immediateLeader"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid(
                            'immediateLeader',
                            professionalInfoForm
                          )
                        "
                      />
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('immediateLeader', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("immediateLeader", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Principales responsabilidades:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="mainResponsibilities"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'mainResponsibilities',
                            professionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'mainResponsibilities',
                          professionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "mainResponsibilities",
                          professionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Logros que te enorgullecen:
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="achievements"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('achievements', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('achievements', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("achievements", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øPor qu√© decidiste cerrar ese ciclo?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="whyCloseCycle"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('whyCloseCycle', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('whyCloseCycle', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("whyCloseCycle", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Languages Section -->
              <div class="form-section">
                <h3 class="section-title">Idiomas que hablas</h3>

                <div class="form-row">
                  <div class="full-width">
                    <label class="field-label"
                      >Ingl√©s <span class="required-asterisk">*</span></label
                    >
                    <div class="language-levels">
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('B√°sico', 'englishLevel')
                        "
                        (click)="selectLanguageLevel('B√°sico', 'englishLevel')"
                        class="language-button"
                      >
                        <span class="language-icon">A</span>
                        <span class="language-text">B√°sico</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('Intermedio', 'englishLevel')
                        "
                        (click)="
                          selectLanguageLevel('Intermedio', 'englishLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">B</span>
                        <span class="language-text">Intermedio</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('Avanzado', 'englishLevel')
                        "
                        (click)="
                          selectLanguageLevel('Avanzado', 'englishLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">C</span>
                        <span class="language-text">Avanzado</span>
                      </button>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('englishLevel', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("englishLevel", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øD√≥nde aprendiste?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="englishLearningPlace"
                        rows="2"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'englishLearningPlace',
                            professionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'englishLearningPlace',
                          professionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "englishLearningPlace",
                          professionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øOtro idioma?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="otherLanguage"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('otherLanguage', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('otherLanguage', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("otherLanguage", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div
                  class="form-row"
                  *ngIf="
                    professionalInfoForm.get('otherLanguage')?.value &&
                    professionalInfoForm
                      .get('otherLanguage')
                      ?.value.toLowerCase() !== 'no'
                  "
                >
                  <div class="full-width">
                    <label class="field-label">Nivel de otro idioma</label>
                    <div class="language-levels">
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'B√°sico',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel('B√°sico', 'otherLanguageLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">A</span>
                        <span class="language-text">B√°sico</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'Intermedio',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel(
                            'Intermedio',
                            'otherLanguageLevel'
                          )
                        "
                        class="language-button"
                      >
                        <span class="language-icon">B</span>
                        <span class="language-text">Intermedio</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'Avanzado',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel('Avanzado', 'otherLanguageLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">C</span>
                        <span class="language-text">Avanzado</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Atr√°s
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitProfessional(stepper)"
                [disabled]="isSubmitting || professionalInfoForm.invalid"
              >
                <span *ngIf="!isSubmitting">Siguiente</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 3: Additional Personal Information -->
          <mat-step [stepControl]="additionalInfoForm">
            <ng-template matStepLabel>Additional Information</ng-template>

            <div class="form-step-content" [formGroup]="additionalInfoForm">
              <h2 class="step-title">
                Un poco m√°s sobre t√≠ (lo que no sale en una hoja de vida)
              </h2>

              <div class="form-section">
                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øC√≥mo te gustar√≠a que te llamen? (Puede ser tu nombre o un
                      diminutivo)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="preferredName"
                        rows="3"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('preferredName', additionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('preferredName', additionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{ getErrorMessage("preferredName", additionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øCu√°l es tu superpoder y cu√°l es tu kryptonita? (Esa
                      habilidad que te hace brillar... y que a veces te funciona
                      en tu contra).
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="superpowerAndKryptonite"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'superpowerAndKryptonite',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'superpowerAndKryptonite',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "superpowerAndKryptonite",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øQu√© te atrajo m√°s sobre esta oportunidad y Celerix?
                      (Queremos saber qu√© conect√≥ contigo)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="whatCaughtAttention"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'whatCaughtAttention',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'whatCaughtAttention',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "whatCaughtAttention",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øQue hace √∫nico tu estilo de trabajo o ver el mundo? (Esa
                      chispa que te diferencia, incluso entre personas con
                      habilidades similares)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="uniqueWorkStyle"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('uniqueWorkStyle', additionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('uniqueWorkStyle', additionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("uniqueWorkStyle", additionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Si supieras hacernos una pregunta para conocer a nuevos
                      candidatos como t√∫... ¬øqu√© ser√≠a? ¬°Proponela! Nos encanta
                      agregar nuevas ideas.
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="questionForCandidates"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'questionForCandidates',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'questionForCandidates',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "questionForCandidates",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Atr√°s
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitAdditional(stepper)"
                [disabled]="isSubmitting || additionalInfoForm.invalid"
              >
                <span *ngIf="!isSubmitting">Siguiente</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 4: Energy Distribution and Scenario -->
          <mat-step [stepControl]="energyScenarioForm">
            <ng-template matStepLabel>Energy & Scenario</ng-template>

            <div class="form-step-content" [formGroup]="energyScenarioForm">
              <h2 class="step-title">En qu√© te gasta tu energ√≠a?</h2>

              <div class="form-section">
                <p class="section-description">
                  ¬øSi tus expectativas y motivaciones sumaran 100%, ¬øc√≥mo
                  repartir√≠as ese porcentaje entre estos aspectos? (Recuerda: no
                  se vale repetir La idea es que priorices lo que m√°s valoras
                  hoy)
                </p>

                <div class="energy-distribution">
                  <div class="form-row">
                    <div class="form-field energy-field">
                      <label class="form-label">
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect1"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect1', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect1', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect1", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect2"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect2', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect2', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect2", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect3"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect3', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect3', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect3", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect4"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect4', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect4', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect4", energyScenarioForm)
                        }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h4 class="section-title">
                  Y si estuvieras en esta situaci√≥n...
                </h4>
                <p class="scenario-text">
                  Est√°s en una reuni√≥n con tu jefe y parte del equipo de gesti√≥n
                  de Celerix. De repente, tu jefe proyecta algunos datos que
                  sabes que son incorrectos. ¬øQu√© haces?
                </p>

                <div class="scenario-options">
                  <mat-radio-group formControlName="scenarioAction">
                    <mat-radio-button
                      *ngFor="let option of scenarioOptions"
                      [value]="option.value"
                      class="scenario-option"
                    >
                      {{ option.label }}
                    </mat-radio-button>
                  </mat-radio-group>
                  <span
                    *ngIf="isFieldInvalid('scenarioAction', energyScenarioForm)"
                    class="form-error"
                  >
                    {{ getErrorMessage("scenarioAction", energyScenarioForm) }}
                  </span>
                </div>

                <div class="form-row" style="margin-top: 1.5rem">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Cuentanos qu√© har√≠as y por qu√©. Lo importante no es solo
                      el "qu√©", sino el "c√≥mo".
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="scenarioExplanation"
                        rows="5"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'scenarioExplanation',
                            energyScenarioForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'scenarioExplanation',
                          energyScenarioForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "scenarioExplanation",
                          energyScenarioForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Atr√°s
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitEnergyScenario(stepper)"
                [disabled]="isSubmitting || energyScenarioForm.invalid"
              >
                <span *ngIf="!isSubmitting">Siguiente</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 5: Answer Your Own Question -->
          <mat-step [stepControl]="answerQuestionForm">
            <ng-template matStepLabel>Answer Your Question</ng-template>

            <div class="form-step-content" [formGroup]="answerQuestionForm">
              <h2 class="step-title">Y ahora, ¬°tu pregunta!</h2>

              <div class="form-section">
                <div class="form-row" style="margin-top: 2rem">
                  <div class="form-field full-width">
                    <label class="form-label">
                      ¬øRecuerdas la pregunta que propusiste hace un momento?
                      <br />
                      Bueno... es hora de que t√∫ tambi√©n la respondas!
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="answerToOwnQuestion"
                        rows="6"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'answerToOwnQuestion',
                            answerQuestionForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'answerToOwnQuestion',
                          answerQuestionForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "answerToOwnQuestion",
                          answerQuestionForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Atr√°s
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitAnswerQuestion(stepper)"
                [disabled]="isSubmitting || answerQuestionForm.invalid"
              >
                <span *ngIf="!isSubmitting">Siguiente</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 6: Final Confirmation -->
          <mat-step>
            <ng-template matStepLabel>Final</ng-template>

            <div class="final-content">
              <h2 class="final-title">Final (Pero no adi√≥s):</h2>

              <div class="final-message">
                <p class="final-text">
                  Porque el match perfecto comienza por conocernos bien... y en
                  Celerix, todo lo bueno empieza con una buena conexi√≥n
                </p>
                <p class="final-text">
                  Gracias por compartir este momento con nosotros.
                </p>
              </div>

              <div class="final-actions">
                <button
                  mat-button
                  type="button"
                  (click)="stepper.previous()"
                  class="back-button"
                >
                  <mat-icon>arrow_back</mat-icon>
                  Atr√°s
                </button>
                <button
                  mat-raised-button
                  color="primary"
                  type="button"
                  (click)="onFinalSubmit()"
                  [disabled]="isSubmitting"
                  class="submit-button"
                >
                  <span *ngIf="!isSubmitting">Enviar</span>
                  <span *ngIf="isSubmitting">Enviando...</span>
                  <mat-icon *ngIf="!isSubmitting">arrow_forward</mat-icon>
                </button>
              </div>
            </div>
          </mat-step>
        </mat-stepper>
      </form>
    </mat-card-content>
  </mat-card>
</div>
