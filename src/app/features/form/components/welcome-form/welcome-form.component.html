<div class="form-container">
  <mat-card class="form-card">
    <mat-card-content>
      <form [formGroup]="personalInfoForm" (ngSubmit)="onSubmit(stepper)">
        <mat-stepper #stepper linear="true" class="form-stepper">
          <!-- Step 1: Personal Information -->
          <mat-step [stepControl]="personalInfoForm">
            <ng-template matStepLabel>Personal Information</ng-template>

            <div class="form-step-content">
              <h2 class="step-title">Personal Information</h2>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Full Name
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="fullName"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('fullName')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('fullName')" class="form-error">
                    {{ getErrorMessage("fullName") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Identity Document
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="identityDocument"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('identityDocument')"
                    />
                  </div>
                  <span
                    *ngIf="isFieldInvalid('identityDocument')"
                    class="form-error"
                  >
                    {{ getErrorMessage("identityDocument") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field half-width">
                  <label class="form-label">
                    Birth Date
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      matInput
                      type="text"
                      formControlName="birthDate"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('birthDate')"
                      [matDatepicker]="birthDatePicker"
                      (focus)="birthDatePicker.open()"
                      readonly
                    />
                    <mat-datepicker #birthDatePicker></mat-datepicker>
                  </div>
                  <span *ngIf="isFieldInvalid('birthDate')" class="form-error">
                    {{ getErrorMessage("birthDate") }}
                  </span>
                </div>

                <div class="form-field half-width">
                  <label class="form-label">
                    Birth Place
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="birthPlace"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('birthPlace')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('birthPlace')" class="form-error">
                    {{ getErrorMessage("birthPlace") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Email
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="email"
                      formControlName="email"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('email')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('email')" class="form-error">
                    {{ getErrorMessage("email") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field half-width">
                  <label class="form-label">
                    City
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <input
                      type="text"
                      formControlName="city"
                      class="form-input"
                      [class.invalid]="isFieldInvalid('city')"
                    />
                  </div>
                  <span *ngIf="isFieldInvalid('city')" class="form-error">
                    {{ getErrorMessage("city") }}
                  </span>
                </div>

                <div class="form-field half-width">
                  <label class="form-label">
                    Country
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="form-input-wrapper">
                    <select
                      formControlName="country"
                      class="form-select"
                      [class.invalid]="isFieldInvalid('country')"
                    >
                      <option value="" disabled>Select your country</option>
                      <option
                        *ngFor="let country of countries"
                        [value]="country"
                      >
                        {{ country }}
                      </option>
                    </select>
                  </div>
                  <span *ngIf="isFieldInvalid('country')" class="form-error">
                    {{ getErrorMessage("country") }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field full-width">
                  <label class="form-label">
                    Phone Number
                    <span class="form-label-required">*</span>
                  </label>
                  <div class="phone-input-wrapper">
                    <div class="phone-country-selector">
                      <button
                        type="button"
                        class="phone-country-button"
                        (click)="toggleCountryDropdown()"
                      >
                        <span class="phone-flag">{{
                          selectedPhoneCountry?.flag || "üè≥Ô∏è"
                        }}</span>
                        <span class="phone-code">{{
                          selectedPhoneCountry?.code || "+57"
                        }}</span>
                        <span class="phone-chevron">‚ñº</span>
                      </button>
                      <div
                        class="phone-country-dropdown"
                        [class.show]="showCountryDropdown"
                      >
                        <div
                          *ngFor="let country of phoneCountries"
                          class="phone-country-option"
                          (click)="selectPhoneCountry(country)"
                        >
                          <span class="phone-flag">{{ country.flag }}</span>
                          <span class="phone-code">{{ country.code }}</span>
                          <span class="phone-name">{{ country.name }}</span>
                        </div>
                      </div>
                    </div>
                    <input
                      type="tel"
                      formControlName="phoneNumber"
                      class="form-input phone-input"
                      [class.invalid]="isFieldInvalid('phoneNumber')"
                    />
                  </div>
                  <span
                    *ngIf="isFieldInvalid('phoneNumber')"
                    class="form-error"
                  >
                    {{ getErrorMessage("phoneNumber") }}
                  </span>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="isSubmitting || personalInfoForm.invalid"
              >
                <span *ngIf="!isSubmitting">Next</span>
                <span *ngIf="isSubmitting">Submitting...</span>
              </button>
              <button mat-button type="button" (click)="onReset()">
                Reset
              </button>
            </div>
          </mat-step>

          <!-- Step 2: Professional Information -->
          <mat-step [stepControl]="professionalInfoForm">
            <ng-template matStepLabel>Professional Information</ng-template>

            <div class="form-step-content" [formGroup]="professionalInfoForm">
              <h2 class="step-title">Your Professional History</h2>

              <!-- Professional History Section -->
              <div class="form-section">
                <h3 class="section-title">Your Professional History</h3>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      School
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="school"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('school', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('school', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("school", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Undergraduate / Postgraduate / Master's
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="degree"
                        rows="3"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('degree', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="isFieldInvalid('degree', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("degree", professionalInfoForm) }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Work Experience Section -->
              <div class="form-section">
                <h3 class="section-title">Work Experience</h3>

                <div class="form-row">
                  <div class="form-field half-width">
                    <label class="form-label">
                      Company
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="company"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('company', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('company', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("company", professionalInfoForm) }}
                    </span>
                  </div>

                  <div class="form-field half-width">
                    <label class="form-label">
                      Position
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="position"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('position', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="isFieldInvalid('position', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("position", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field half-width">
                    <label class="form-label">
                      Start Date
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        matInput
                        type="text"
                        formControlName="startDate"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('startDate', professionalInfoForm)
                        "
                        [matDatepicker]="startDatePicker"
                        (focus)="startDatePicker.open()"
                        readonly
                      />
                      <mat-datepicker #startDatePicker></mat-datepicker>
                    </div>
                    <span
                      *ngIf="isFieldInvalid('startDate', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("startDate", professionalInfoForm) }}
                    </span>
                  </div>

                  <div class="form-field half-width">
                    <label class="form-label">
                      End Date
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        matInput
                        type="text"
                        formControlName="endDate"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('endDate', professionalInfoForm)
                        "
                        [matDatepicker]="endDatePicker"
                        (focus)="endDatePicker.open()"
                        readonly
                      />
                      <mat-datepicker #endDatePicker></mat-datepicker>
                    </div>
                    <span class="text-xs text-gray-500 mt-1 block">
                      If you are currently at the company, add today's date and
                      write "Currently" here
                    </span>
                    <span
                      *ngIf="isFieldInvalid('endDate', professionalInfoForm)"
                      class="form-error"
                    >
                      {{ getErrorMessage("endDate", professionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Immediate Leader
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="immediateLeader"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid(
                            'immediateLeader',
                            professionalInfoForm
                          )
                        "
                      />
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('immediateLeader', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("immediateLeader", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Main Responsibilities
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="mainResponsibilities"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'mainResponsibilities',
                            professionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'mainResponsibilities',
                          professionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "mainResponsibilities",
                          professionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Achievements You Are Proud Of
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="achievements"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('achievements', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('achievements', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("achievements", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Why Did You Decide to Close That Cycle?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="whyCloseCycle"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('whyCloseCycle', professionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('whyCloseCycle', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("whyCloseCycle", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Languages Section -->
              <div class="form-section">
                <h3 class="section-title">Languages You Speak</h3>

                <div class="form-row">
                  <div class="full-width">
                    <label class="field-label"
                      >English <span class="required-asterisk">*</span></label
                    >
                    <div class="language-levels">
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('B√°sico', 'englishLevel')
                        "
                        (click)="selectLanguageLevel('B√°sico', 'englishLevel')"
                        class="language-button"
                      >
                        <span class="language-icon">A</span>
                        <span class="language-text">B√°sico</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('Intermedio', 'englishLevel')
                        "
                        (click)="
                          selectLanguageLevel('Intermedio', 'englishLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">B</span>
                        <span class="language-text">Intermedio</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected('Avanzado', 'englishLevel')
                        "
                        (click)="
                          selectLanguageLevel('Avanzado', 'englishLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">C</span>
                        <span class="language-text">Avanzado</span>
                      </button>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('englishLevel', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("englishLevel", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Where Did You Learn It?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="englishLearningPlace"
                        rows="2"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'englishLearningPlace',
                            professionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'englishLearningPlace',
                          professionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "englishLearningPlace",
                          professionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Another Language?
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <input
                        type="text"
                        formControlName="otherLanguage"
                        class="form-input"
                        [class.invalid]="
                          isFieldInvalid('otherLanguage', professionalInfoForm)
                        "
                      />
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('otherLanguage', professionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("otherLanguage", professionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div
                  class="form-row"
                  *ngIf="
                    professionalInfoForm.get('otherLanguage')?.value &&
                    professionalInfoForm
                      .get('otherLanguage')
                      ?.value.toLowerCase() !== 'no'
                  "
                >
                  <div class="full-width">
                    <label class="field-label">Other Language Level</label>
                    <div class="language-levels">
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'B√°sico',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel('B√°sico', 'otherLanguageLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">A</span>
                        <span class="language-text">B√°sico</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'Intermedio',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel(
                            'Intermedio',
                            'otherLanguageLevel'
                          )
                        "
                        class="language-button"
                      >
                        <span class="language-icon">B</span>
                        <span class="language-text">Intermedio</span>
                      </button>
                      <button
                        type="button"
                        [class.selected]="
                          isLanguageLevelSelected(
                            'Avanzado',
                            'otherLanguageLevel'
                          )
                        "
                        (click)="
                          selectLanguageLevel('Avanzado', 'otherLanguageLevel')
                        "
                        class="language-button"
                      >
                        <span class="language-icon">C</span>
                        <span class="language-text">Avanzado</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Back
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitProfessional(stepper)"
                [disabled]="isSubmitting || professionalInfoForm.invalid"
              >
                <span *ngIf="!isSubmitting">Next</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 3: Additional Personal Information -->
          <mat-step [stepControl]="additionalInfoForm">
            <ng-template matStepLabel>Additional Information</ng-template>

            <div class="form-step-content" [formGroup]="additionalInfoForm">
              <h2 class="step-title">A Little More About You</h2>
              <p class="step-subtitle">(What doesn't appear on a resume)</p>

              <div class="form-section">
                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      What do you like to be called? (Can be your name or a
                      diminutive)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="preferredName"
                        rows="3"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('preferredName', additionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('preferredName', additionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{ getErrorMessage("preferredName", additionalInfoForm) }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      What is your superpower and what is your kryptonite? (That
                      ability that makes you shine... and that sometimes works
                      against you).
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="superpowerAndKryptonite"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'superpowerAndKryptonite',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'superpowerAndKryptonite',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "superpowerAndKryptonite",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      What caught your attention most about this opportunity and
                      Celerix? (We want to know what connected with you)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="whatCaughtAttention"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'whatCaughtAttention',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'whatCaughtAttention',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "whatCaughtAttention",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      What makes your way of working or seeing the world unique?
                      (That spark that differentiates you, even among people
                      with similar skills)
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="uniqueWorkStyle"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid('uniqueWorkStyle', additionalInfoForm)
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid('uniqueWorkStyle', additionalInfoForm)
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage("uniqueWorkStyle", additionalInfoForm)
                      }}
                    </span>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-field full-width">
                    <label class="form-label">
                      If you could ask us a question to better get to know new
                      candidates like you... what would it be? Propose it! We
                      love to add new ideas.
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="questionForCandidates"
                        rows="4"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'questionForCandidates',
                            additionalInfoForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'questionForCandidates',
                          additionalInfoForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "questionForCandidates",
                          additionalInfoForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Back
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitAdditional(stepper)"
                [disabled]="isSubmitting || additionalInfoForm.invalid"
              >
                <span *ngIf="!isSubmitting">Next</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 4: Energy Distribution and Scenario -->
          <mat-step [stepControl]="energyScenarioForm">
            <ng-template matStepLabel>Energy & Scenario</ng-template>

            <div class="form-step-content" [formGroup]="energyScenarioForm">
              <h2 class="step-title">Where Do You Put Your Energy?</h2>

              <div class="form-section">
                <p class="section-description">
                  If your expectations and motivations added up to 100%, how
                  would you distribute that percentage among these aspects?
                  (Remember: no repetition allowed. The idea is that you
                  prioritize what you value most today)
                </p>

                <div class="energy-distribution">
                  <div class="form-row">
                    <div class="form-field energy-field">
                      <label class="form-label">
                        {{ energyAspects[0] }}
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect1"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect1', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect1', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect1", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        {{ energyAspects[1] }}
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect2"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect2', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect2', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect2", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        {{ energyAspects[2] }}
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect3"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect3', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect3', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect3", energyScenarioForm)
                        }}
                      </span>
                    </div>

                    <div class="form-field energy-field">
                      <label class="form-label">
                        {{ energyAspects[3] }}
                        <span class="form-label-required">*</span>
                      </label>
                      <div class="form-input-wrapper">
                        <input
                          type="number"
                          formControlName="energyAspect4"
                          min="0"
                          max="100"
                          class="form-input"
                          [class.invalid]="
                            isFieldInvalid('energyAspect4', energyScenarioForm)
                          "
                          (input)="energyScenarioForm.updateValueAndValidity()"
                        />
                        <span
                          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
                          >%</span
                        >
                      </div>
                      <span
                        *ngIf="
                          isFieldInvalid('energyAspect4', energyScenarioForm)
                        "
                        class="form-error"
                      >
                        {{
                          getErrorMessage("energyAspect4", energyScenarioForm)
                        }}
                      </span>
                    </div>
                  </div>

                  <div
                    class="percentage-sum"
                    [class.invalid]="energyScenarioForm.errors?.['invalidPercentageSum']"
                  >
                    <strong>Total: {{ getEnergyPercentageSum() }}%</strong>
                    <span
                      *ngIf="energyScenarioForm.errors?.['invalidPercentageSum']"
                      class="error-text"
                    >
                      (Must equal 100%)
                    </span>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="section-title">
                  And If You Were In This Situation...
                </h3>
                <p class="scenario-text">
                  You are in a meeting with your boss and part of the Celerix
                  management team. Suddenly, your boss projects some figures
                  that you know are incorrect. What do you do?
                </p>

                <div class="scenario-options">
                  <mat-radio-group formControlName="scenarioAction">
                    <mat-radio-button
                      *ngFor="let option of scenarioOptions"
                      [value]="option.value"
                      class="scenario-option"
                    >
                      {{ option.label }}
                    </mat-radio-button>
                  </mat-radio-group>
                  <span
                    *ngIf="isFieldInvalid('scenarioAction', energyScenarioForm)"
                    class="form-error"
                  >
                    {{ getErrorMessage("scenarioAction", energyScenarioForm) }}
                  </span>
                </div>

                <div class="form-row" style="margin-top: 1.5rem">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Tell us what you would do and why. The important thing is
                      not just the "what", but the "how".
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="scenarioExplanation"
                        rows="5"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'scenarioExplanation',
                            energyScenarioForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'scenarioExplanation',
                          energyScenarioForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "scenarioExplanation",
                          energyScenarioForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Back
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitEnergyScenario(stepper)"
                [disabled]="isSubmitting || energyScenarioForm.invalid"
              >
                <span *ngIf="!isSubmitting">Next</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 5: Answer Your Own Question -->
          <mat-step [stepControl]="answerQuestionForm">
            <ng-template matStepLabel>Answer Your Question</ng-template>

            <div class="form-step-content" [formGroup]="answerQuestionForm">
              <h2 class="step-title">And Now, Your Question!</h2>

              <div class="form-section">
                <p class="section-description">
                  Do you remember the question you proposed a moment ago?
                </p>
                <p class="section-description">
                  Well... it's time for you to answer it too!
                  <span class="required-asterisk">*</span>
                </p>

                <div class="question-display">
                  <h3 class="question-label">Your Question:</h3>
                  <p class="question-text">
                    {{ additionalInfoForm.get("questionForCandidates")?.value }}
                  </p>
                </div>

                <div class="form-row" style="margin-top: 2rem">
                  <div class="form-field full-width">
                    <label class="form-label">
                      Your Answer
                      <span class="form-label-required">*</span>
                    </label>
                    <div class="form-input-wrapper">
                      <textarea
                        formControlName="answerToOwnQuestion"
                        rows="6"
                        class="form-textarea"
                        [class.invalid]="
                          isFieldInvalid(
                            'answerToOwnQuestion',
                            answerQuestionForm
                          )
                        "
                      ></textarea>
                    </div>
                    <span
                      *ngIf="
                        isFieldInvalid(
                          'answerToOwnQuestion',
                          answerQuestionForm
                        )
                      "
                      class="form-error"
                    >
                      {{
                        getErrorMessage(
                          "answerToOwnQuestion",
                          answerQuestionForm
                        )
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button mat-button type="button" (click)="stepper.previous()">
                <mat-icon>arrow_back</mat-icon>
                Back
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="onSubmitAnswerQuestion(stepper)"
                [disabled]="isSubmitting || answerQuestionForm.invalid"
              >
                <span *ngIf="!isSubmitting">Next</span>
                <span *ngIf="isSubmitting">Submitting...</span>
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>

          <!-- Step 6: Final Confirmation -->
          <mat-step>
            <ng-template matStepLabel>Final</ng-template>

            <div class="final-content">
              <h2 class="final-title">Final (Pero no adi√≥s):</h2>

              <div class="final-message">
                <p class="final-text">
                  Porque el match perfecto comienza por conocernos bien... y en
                  Celerix, todo lo bueno empieza con una buena conexi√≥n
                </p>
                <p class="final-text">
                  Gracias por compartir este momento con nosotros.
                </p>
              </div>

              <div class="final-actions">
                <button
                  mat-button
                  type="button"
                  (click)="stepper.previous()"
                  class="back-button"
                >
                  <mat-icon>arrow_back</mat-icon>
                  Atr√°s
                </button>
                <button
                  mat-raised-button
                  color="primary"
                  type="button"
                  (click)="onFinalSubmit()"
                  [disabled]="isSubmitting"
                  class="submit-button"
                >
                  <span *ngIf="!isSubmitting">Enviar</span>
                  <span *ngIf="isSubmitting">Enviando...</span>
                  <mat-icon *ngIf="!isSubmitting">arrow_forward</mat-icon>
                </button>
              </div>
            </div>
          </mat-step>
        </mat-stepper>
      </form>
    </mat-card-content>
  </mat-card>
</div>
